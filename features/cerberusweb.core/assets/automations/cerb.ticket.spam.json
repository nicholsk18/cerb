{
    "name": "cerb.ticket.spam",
    "extension_id": "cerb.trigger.interaction.worker",
    "description": "An interaction for quickly reporting tickets as spam",
    "script": "inputs:\r\n  record/ticket:\r\n    required@bool: yes\r\n    record_type: ticket\r\n  text/status:\r\n    type: freeform\r\n    required@bool: yes\r\n  text/confirm:\r\n    type: bool\r\n    default: no\r\n\r\nstart:\r\n  decision/validate:\r\n    outcome/noPerm:\r\n      if@bool:\r\n        {{\r\n          not cerb_record_writeable('ticket',inputs.ticket.id,'worker',worker_id) \r\n          or not cerb_has_priv('core.ticket.actions.spam','worker',worker_id)\r\n        }}\r\n      then:\r\n        return:\r\n    outcome/invalidStatus:\r\n      if@bool: {{inputs.status not in ['open','closed','waiting','deleted']}}\r\n      then:\r\n        log.error: `inputs.status` ({{inputs.status}}) must be one of: open, closed, waiting, deleted\r\n        return:\r\n\r\n  # Do we need a confirmation?\r\n  outcome/confirm:\r\n    if@bool: {{inputs.confirm}}\r\n    then:\r\n      await:\r\n        form:\r\n          title: Confirm\r\n          elements:\r\n            say/confirm:\r\n              content@text:\r\n                ### Are you sure you want to report this ticket as spam?\r\n            submit/prompt_confirm:\r\n              buttons:\r\n                continue/yes:\r\n                  label: Continue\r\n                  icon: circle-ok\r\n                  icon_at: start\r\n                  value: yes\r\n                continue/no:\r\n                  label: Cancel\r\n                  icon: circle-remove\r\n                  icon_at: start\r\n                  value:  no\r\n                  style: secondary\r\n      outcome/cancel:\r\n        if@bool: {{prompt_confirm != 'yes'}}\r\n        then:\r\n          return:\r\n  \r\n  api.command:\r\n    inputs:\r\n      name: cerb.commands.email.spam.train\r\n      params:\r\n        ticket_id@int: {{inputs.ticket.id}}\r\n  \r\n  outcome/status:\r\n    if@bool: {{inputs.status}}\r\n    then:\r\n      record.update/ticket:\r\n        output: updated_ticket\r\n        inputs:\r\n          record_type: ticket\r\n          record_id: {{inputs.ticket.id}}\r\n          fields:\r\n            status: {{inputs.status}}",
    "policy_kata": "commands:\r\n  api.command:\r\n    deny/name@bool: {{inputs.name not in ['cerb.commands.email.spam.train']}}\r\n    allow@bool: yes\r\n  record.update:\r\n    deny/type@bool: {{inputs.record_type is not record type ('ticket')}}\r\n    allow@bool: yes",
    "created_at": 1714427334,
    "updated_at": 1714427334
}